import socket
import pyaudio
import threading  # Don't forget to import the threading module

def handle_client(client_socket, address):
    print(f"Accepted connection from {address}")

    p = pyaudio.PyAudio()
    stream = p.open(format=pyaudio.paInt16, channels=1, rate=44100, output=True)

    while True:
        try:
            data, _ = client_socket.recvfrom(1024)
            if not data:
                break
            stream.write(data)
        except socket.error:
            break

    stream.stop_stream()
    stream.close()
    p.terminate()
    client_socket.close()
    print(f"Connection from {address} closed")

def start_server():
    server_ip = ' 192.168.56.1'  # Listen on all available interfaces
    server_port = 12345

    server_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    server_socket.bind((server_ip, server_port))

    print(f"Server listening on {server_ip}:{server_port}")

    while True:
        data, client_address = server_socket.recvfrom(1024)
        threading.Thread(target=handle_client, args=(server_socket, client_address)).start()

if _name_ == "_main_":
    start_server()